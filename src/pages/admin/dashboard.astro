---
import MainLayout from "../../layouts/MainLayout.astro";
import SlideEditor from "../../components/admin/SlideEditor.vue";
import AdminNav from "../../components/admin/AdminNav.vue";
---

<MainLayout title="Admin Dashboard - ISUZU STC">
  <div class="min-h-screen bg-gray-900 pt-20 pb-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Header -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-white mb-2">
          ระบบหลังบ้าน (Admin Dashboard)
        </h1>
        <p class="text-gray-400">
          จัดการข้อมูลและรูปภาพในหน้าเว็บไซต์ ISUZU STC
        </p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        <!-- Sidebar Navigation -->
        <div class="lg:col-span-1">
          <AdminNav client:load />
        </div>

        <!-- Main Content -->
        <div class="lg:col-span-3">
          <div class="bg-gray-800/50 rounded-2xl p-6 border border-gray-700">
            <div class="mb-8 border-b border-gray-700 pb-4">
              <h2 class="text-2xl font-bold text-white">จัดการ Slideshow</h2>
              <p class="text-gray-400 mt-1">จัดการรูปภาพ Banner ยามหน้าแรก</p>
            </div>
            <SlideEditor client:only="vue" />
          </div>
        </div>
      </div>
    </div>
  </div>
</MainLayout>

<script>
  import { supabase } from "../../lib/supabase";

  // Check Auth
  const checkAuth = async () => {
    const {
      data: { session },
    } = await supabase.auth.getSession();

    if (!session) {
      window.location.href = "/admin/login";
      return;
    }

    // Display user email
    const userEmailEl = document.getElementById("userEmail");
    if (userEmailEl && session.user.email) {
      userEmailEl.textContent = session.user.email;
    }
  };

  // Logout
  const logoutBtn = document.getElementById("logoutBtn");
  if (logoutBtn) {
    logoutBtn.addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "/admin/login";
    });
  }

  checkAuth();
</script>
